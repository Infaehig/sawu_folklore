% Main auxilliary definitions
% Sa Wu, 2020-03-19

\newcommand{\cuadrodebaile}[1]{\fbox{
	\begin{tikzpicture}[shorten >=1mm,shorten <=1mm,very thick,>={Stealth[length=\arrowlength,width=\arrowwidth]},>->]
		\draw[opacity=0] ($-{(\unita+\padding)}*(1,1)$) rectangle (${(\unita+\padding)}*(1,1)$);
		\coordinate(C) at (0,0);
		\coordinate(B) at ($(C)-(0,\unita+\separation)$);
		\coordinate(R) at ($(C)+(\unita+\separation,0)$);
		\coordinate(T) at ($(C)+(0,\unita+\separation)$);
		\coordinate(L) at ($(C)-(\unita+\separation,0)$);
		\coordinate(BL) at ($(C)-(\unita+\separation,\unita+\separation)$);
		\coordinate(BR) at ($(C)+(\unita+\separation,-\unita-\separation)$);
		\coordinate(TR) at ($(C)+(\unita+\separation,\unita+\separation)$);
		\coordinate(TL) at ($(C)-(\unita+\separation,-\unita-\separation)$);
		\coordinate(b) at ($(C)-(0,\unitb+\separation)$);
		\coordinate(r) at ($(C)+(\unitb+\separation,0)$);
		\coordinate(t) at ($(C)+(0,\unitb+\separation)$);
		\coordinate(l) at ($(C)-(\unitb+\separation,0)$);
		\coordinate(bl) at ($(C)-(\unitb+\separation,\unitb+\separation)$);
		\coordinate(br) at ($(C)+(\unitb+\separation,-\unitb-\separation)$);
		\coordinate(tr) at ($(C)+(\unitb+\separation,\unitb+\separation)$);
		\coordinate(tl) at ($(C)-(\unitb+\separation,-\unitb-\separation)$);
		#1
	\end{tikzpicture}
}}

\newcommand{\sizednode}[1][]{\node[minimum size=\nodesize,draw,regular polygon,regular polygon sides=3,#1]}
\newcommand{\nodea}[2]{\sizednode[\colora,shape border rotate=#2](1) at (#1) {};}
\newcommand{\nodeb}[2]{\sizednode[\colorb,shape border rotate=#2](2) at (#1) {};}

\newcommand{\colocacionunob}[1]{\cuadrodebaile{
	\nodea{B}{0}\nodeb{T}{180}
	\coordinate(fr) at ($(\unita*0.5,\unita*0.5)$);
	\coordinate(fl) at ($(-\unita*0.5,\unita*0.5)$);
	\coordinate(fc) at ($0.5*(fr)+0.5*(fl)-0.5*(1)$);
	\coordinate(FR) at ($(R)-(1)$);
	\coordinate(FL) at ($(L)-(1)$);
	#1
}}

\newcommand{\colocacionunot}[1]{\cuadrodebaile{
	\nodea{T}{180}\nodeb{B}{0}
	\coordinate(fr) at ($(-\unita*0.5,-\unita*0.5)$);
	\coordinate(fl) at ($(\unita*0.5,-\unita*0.5)$);
	\coordinate(fc) at ($0.5*(fr)+0.5*(fl)-0.5*(1)$);
	\coordinate(FR) at ($(L)-(1)$);
	\coordinate(FL) at ($(R)-(1)$);
	#1
}}

\newcommand{\colocaciondosbr}[1]{\cuadrodebaile{
	\nodea{br}{45}\nodeb{tl}{225}
	\coordinate(fr) at ($(0,\unitb)$);
	\coordinate(fl) at ($(-\unitb,0)$);
	\coordinate(fc) at ($0.5*(fr)+0.5*(fl)-0.5*(1)$);
	\coordinate(FR) at ($(tr)-(1)$);
	\coordinate(FL) at ($(bl)-(1)$);
	#1
}}

\newcommand{\colocaciondosbl}[1]{\cuadrodebaile{
	\nodea{bl}{315}\nodeb{tr}{135}
	\coordinate(fr) at ($(\unitb,0)$);
	\coordinate(fl) at ($(0,\unitb)$);
	\coordinate(fc) at ($0.5*(fr)+0.5*(fl)-0.5*(1)$);
	\coordinate(FR) at ($(br)-(1)$);
	\coordinate(FL) at ($(tl)-(1)$);
	#1
}}

\newcommand{\colocaciondostl}[1]{\cuadrodebaile{
	\nodea{tl}{225}\nodeb{br}{45}
	\coordinate(fr) at ($(0,-\unitb)$);
	\coordinate(fl) at ($(\unitb,0)$);
	\coordinate(fc) at ($0.5*(fr)+0.5*(fl)-0.5*(1)$);
	\coordinate(FR) at ($(bl)-(1)$);
	\coordinate(FL) at ($(tr)-(1)$);
	#1
}}

\newcommand{\colocaciondostr}[1]{\cuadrodebaile{
	\nodea{tr}{135}\nodeb{bl}{315}
	\coordinate(fr) at ($(-\unitb,0)$);
	\coordinate(fl) at ($(0,-\unitb)$);
	\coordinate(fc) at ($0.5*(fr)+0.5*(fl)-0.5*(1)$);
	\coordinate(FR) at ($(tl)-(1)$);
	\coordinate(FL) at ($(br)-(1)$);
	#1
}}

\newcommand{\encuentroacl}[2][]{
	\sizednode[opacity=0](n1) at ($(1)+\returnoffset*(fr)$) {};
	\coordinate(n2) at ($(1)+(fr)+(fl)-\returnoffset*(fl)$);
	\coordinate(n3) at ($(1)+(fr)+(fl)-\returnoffset*(fr)$);
	\sizednode[opacity=0](n4) at ($(1)+\returnoffset*(fl)$) {};
	\draw[rounded corners=\nodesize*0.5,#1](n1) to["#2"'] (n2) to (n3) to (n4);
}
\newcommand{\encuentroal}[2][]{\encuentroacl[\colora,#1]{#2}}
\newcommand{\encuentroa}[1][]{\encuentroal[#1]{}}
\newcommand{\encuentrobcl}[2][]{
	\sizednode[opacity=0](n1) at ($(2)-\returnoffset*(fr)$) {};
	\coordinate(n2) at ($(2)-(fr)-(fl)+\returnoffset*(fl)$);
	\coordinate(n3) at ($(2)-(fr)-(fl)+\returnoffset*(fr)$);
	\sizednode[opacity=0](n4) at ($(2)-\returnoffset*(fl)$) {};
	\draw[rounded corners=\nodesize*0.5,#1](n1) to["#2"'] (n2) to (n3) to (n4);
}
\newcommand{\encuentrobl}[2][]{\encuentrobcl[\colorb,#1]{#2}}
\newcommand{\encuentrob}[1][]{\encuentrobl[#1]{}}
\newcommand{\encuentros}{\encuentroa\encuentrob}

\newcommand{\rhomboacl}[2][]{\draw[#1](1) to["#2"'] ($(1)+(fr)$) to ($(1)+(fr)+(fl)$) to ($(1)+(fl)$) to (1);}
\newcommand{\rhomboal}[2][]{\rhomboacl[\colora,#1]{#2}}
\newcommand{\rhomboa}[1][]{\rhomboal[#1]{}}
\newcommand{\rhombobcl}[2][]{\draw[#1](2) to["#2"'] ($(2)-(fr)$) to ($(2)-(fr)-(fl)$) to ($(2)-(fl)$) to (2);}
\newcommand{\rhombobl}[2][]{\rhombobcl[\colorb,#1]{#2}}
\newcommand{\rhombob}[1][]{\rhombobl[#1]{}}
\newcommand{\rhombos}{\rhomboa\rhombob}

\newcommand{\contrarhomboacl}[2][]{\draw[#1](1) to["#2"'] ($(1)+(fl)$) to ($(1)+(fr)+(fl)$) to ($(1)+(fr)$) to (1);}
\newcommand{\contrarhomboal}[2][]{\contrarhomboacl[\colora,#1]{#2}}
\newcommand{\contrarhomboa}[1][]{\contrarhomboa[#1]{}}
\newcommand{\contrarhombobcl}[2][]{\draw[#1](2) to["#2"'] ($(2)-(fl)$) to ($(2)-(fr)-(fl)$) to ($(2)-(fr)$) to (2);}
\newcommand{\contrarhombobl}[2][]{\contrarhombobcl[\colorb,#1]{#2}}
\newcommand{\contrarhombob}[1][]{\contrarhombob[#1]{}}
\newcommand{\contrarhombos}{\contrarhomboa\contrarhombob}

\newcommand{\giroacl}[2][]{\rhomboacl[bend right,out=-40,in=-140,#1]{#2}}
\newcommand{\giroal}[2][]{\giroacl[\colora,#1]{#2}}
\newcommand{\giroa}[1][]{\giroal[#1]{}}
\newcommand{\girobcl}[2][]{\rhombobcl[bend right,out=-40,in=-140,#1]{#2}}
\newcommand{\girobl}[2][]{\girobcl[\colorb,#1]{#2}}
\newcommand{\girob}[1][]{\girobl[#1]{}}
\newcommand{\giros}{\giroa\girob}

\newcommand{\contragiroacl}[2][]{\contrarhomboacl[bend left,out=40,in=140,#1]{#2}}
\newcommand{\contragiroal}[2][]{\contragiroacl[\colora,#1]{#2}}
\newcommand{\contragiroa}[1][]{\contragiroal[#1]{}}
\newcommand{\contragirobcl}[2][]{\contrarhombobcl[bend left,out=40,in=140,#1]{#2}}
\newcommand{\contragirobl}[2][]{\contragirobcl[\colorb,#1]{#2}}
\newcommand{\contragirob}[1][]{\contragirobl[#1]{}}
\newcommand{\contragiros}{\contragiroa\contragirob}

\newcommand{\mediavueltaacls}[3][]{
	\sizednode[opacity=0](n1) at ($#2*(1)$) {};
	\sizednode[opacity=0](n2) at ($#2*(1)+#2*(FR)$) {};
	\sizednode[opacity=0](n3) at ($#2*(2)$) {};
	\draw[bend right,out=-45,in=-135,#1](n1) to["#3"'] (n2) to (n3);
}
\newcommand{\mediavueltaals}[3][]{\mediavueltaacls[\colora,#1]{#2}{#3}}
\newcommand{\mediavueltaas}[2][]{\mediavueltaals[#1]{#2}{}}
\newcommand{\mediavueltaa}[1][]{\mediavueltaas[#1]{1.0}}
\newcommand{\mediavueltabcls}[3][]{
	\sizednode[opacity=0](n1) at ($#2*(2)$) {};
	\sizednode[opacity=0](n2) at ($#2*(2)-#2*(FR)$) {};
	\sizednode[opacity=0](n3) at ($#2*(1)$) {};
	\draw[bend right,out=-45,in=-135,#1](n1) to["#3"'] (n2) to (n3);
}
\newcommand{\mediavueltabls}[3][]{\mediavueltabcls[\colorb,#1]{#2}{#3}}
\newcommand{\mediavueltabs}[2][]{\mediavueltabls[#1]{#2}{}}
\newcommand{\mediavueltab}[1][]{\mediavueltabs[#1]{1.0}}
\newcommand{\mediavueltas}{\mediavueltaa\mediavueltab}

\newcommand{\vueltaacls}[3][]{\mediavueltaacls[>-,#1]{#2}{#3}\mediavueltabcls[->,#1]{#2}{#3}}
\newcommand{\vueltaals}[3][]{\vueltaacls[\colora,#1]{#2}{#3}}
\newcommand{\vueltaas}[2][]{\vueltaals[#1]{#2}{}}
\newcommand{\vueltaa}[1][]{\vueltaas[#1]{1.0}}
\newcommand{\vueltabcls}[3][]{\mediavueltabcls[>-,#1]{#2}{#3}\mediavueltaacls[->,#1]{#2}{#3}}
\newcommand{\vueltabls}[3][]{\vueltabcls[\colorb,#1]{#2}{#3}}
\newcommand{\vueltabs}[2][]{\vueltabls[#1]{#2}{}}
\newcommand{\vueltab}[1][]{\vueltabs[#1]{1.0}}
\newcommand{\vueltas}{\vueltaa\vueltabs{0.95}}